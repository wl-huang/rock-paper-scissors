<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çŒœæ‹³éŠæˆ²</title>
  <style>
    body { font-family: system-ui, "å¾®è»Ÿæ­£é»‘é«”"; padding:1.2rem; background:#f6f8fa; color:#222; }
    .container { max-width:920px; margin:0 auto; background:#fff; padding:1.2rem; border-radius:10px; box-shadow:0 6px 18px rgba(30,30,30,0.06); }
    .hidden { display:none; }
    .choices { display:flex; gap:0.6rem; margin:1rem 0; }
    .choice-btn { flex:1; padding:0.75rem; border-radius:8px; border:1px solid #ddd; background:linear-gradient(#fff,#f2f4f7); cursor:pointer; font-size:1.05rem; font-weight:600; }
    .result { margin-top:1rem; padding:0.75rem; border-radius:8px; border:1px dashed #e4e7eb; background:#fcfdff; }
    .small { font-size:0.85rem; color:#666; }
    .settings label { font-size:0.9rem; color:#333; display:block; margin-top:0.4rem; }
    input[type="number"], select { margin-left:0.4rem; }
    button { cursor:pointer; padding:0.6rem 1rem; border-radius:6px; border:1px solid #ccc; background:#f9f9f9; font-size:1rem; }
    .scoreboard { display:flex; gap:0.8rem; margin-top:1rem; }
    .score-box { flex:1; padding:0.6rem; border-radius:8px; background:#f8fafc; border:1px solid #eef2f7; text-align:center; }
    .log { margin-top:1rem; max-height:220px; overflow:auto; padding:0.6rem; background:#fafafa; border-radius:8px; border:1px solid #eee; font-size:0.95rem; white-space:pre-wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h1>çŒœæ‹³éŠæˆ²</h1>

    <!-- ä¸€é–‹å§‹é¡¯ç¤ºè¨­å®šå€ -->
    <div id="setup">
      <p class="small">è«‹å…ˆè¨­å®šåƒæ•¸ï¼Œå†é–‹å§‹éŠæˆ²ã€‚</p>
      <div class="settings">
        <label>å¹³æ»‘ Î±ï¼š<input id="alpha" type="number" step="0.1" min="0" value="0.5"></label>
        <label>æ¢ç´¢ç‡ Îµï¼š<input id="epsilon" type="number" step="0.01" min="0" max="1" value="0.12"></label>
        <label>è¨˜æ†¶ä¸Šé™ï¼ˆmaxHistï¼‰ï¼š<input id="maxHist" type="number" min="10" value="200"></label>
        <label>å›æ‡‰æ¨¡å¼ï¼š
          <select id="responseMode">
            <option value="mixed">æ··åˆå›æ‡‰</option>
            <option value="max">æœ€å¤§ååˆ¶</option>
          </select>
        </label>
        <button id="startBtn">é–‹å§‹éŠæˆ²</button>
      </div>
    </div>

    <!-- éŠæˆ²å€ï¼Œåˆå§‹éš±è— -->
    <div id="game" class="hidden">
      <div class="choices">
        <button class="choice-btn" data-move="scissors">âœŒï¸ å‰ªåˆ€</button>
        <button class="choice-btn" data-move="rock">ğŸª¨ çŸ³é ­</button>
        <button class="choice-btn" data-move="paper">ğŸ§» å¸ƒ</button>
      </div>

      <div class="result">
        <div id="roundInfo">å°šæœªé–‹å§‹</div>
        <div id="who" style="font-weight:700; margin-top:0.4rem;"></div>
        <div id="aiInfo" style="margin-top:0.5rem; font-size:0.95rem; color:#333;"></div>
      </div>

      <div class="scoreboard">
        <div class="score-box"><div class="small">ä½ </div><div id="playerScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
        <div class="score-box"><div class="small">å¹³æ‰‹</div><div id="drawScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
        <div class="score-box"><div class="small">é›»è…¦</div><div id="computerScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
      </div>

      <button id="resetBtn" style="margin-top:0.8rem;">é‡è¨­æ¯”åˆ†èˆ‡ AI ç´€éŒ„</button>
      <div class="log" id="log"><div class="small">éŠæˆ²ç´€éŒ„ï¼ˆæœ€è¿‘è¨˜éŒ„ï¼‰</div></div>
    </div>
  </div>

  <script>
    const moves = ['scissors','rock','paper'];
    const labels = { 'scissors': 'å‰ªåˆ€ âœŒï¸', 'rock': 'çŸ³é ­ ğŸª¨', 'paper': 'å¸ƒ ğŸ§»' };

    // ç‹€æ…‹
    let alpha, epsilon, maxHist, responseMode;
    let playerScore=0, computerScore=0, drawScore=0;
    let prevPlayer=null;
    let transitionCounts, historyLog=[];

    // DOM
    const startBtn=document.getElementById('startBtn');
    const game=document.getElementById('game');
    const setup=document.getElementById('setup');
    const roundInfoEl=document.getElementById('roundInfo');
    const whoEl=document.getElementById('who');
    const aiInfoEl=document.getElementById('aiInfo');
    const logEl=document.getElementById('log');
    const playerScoreEl=document.getElementById('playerScore');
    const computerScoreEl=document.getElementById('computerScore');
    const drawScoreEl=document.getElementById('drawScore');
    const resetBtn=document.getElementById('resetBtn');

    function initAI(){
      transitionCounts={
        'scissors':{'scissors':0,'rock':0,'paper':0},
        'rock':{'scissors':0,'rock':0,'paper':0},
        'paper':{'scissors':0,'rock':0,'paper':0}
      };
      prevPlayer=null;
      historyLog=[];
      playerScore=computerScore=drawScore=0;
    }

    startBtn.addEventListener('click',()=>{
      alpha=parseFloat(document.getElementById('alpha').value)||1;
      epsilon=parseFloat(document.getElementById('epsilon').value)||0.12;
      maxHist=parseInt(document.getElementById('maxHist').value,10)||200;
      responseMode=document.getElementById('responseMode').value;
      initAI();
      setup.classList.add('hidden');
      game.classList.remove('hidden');
      renderLog();
    });

    function randomMove(){return moves[Math.floor(Math.random()*moves.length)];}
    function decideOutcome(p,c){
      if(p===c)return 'draw';
      const win={'scissors':'paper','rock':'scissors','paper':'rock'};
      return win[p]===c?'win':'lose';
    }
    function updateTransition(prev,cur){
      if(prev&&transitionCounts[prev])transitionCounts[prev][cur]++;
    }
    function getConditionalProbs(prev){
      const counts=transitionCounts[prev]; let probs={},sum=0;
      for(let m of moves){probs[m]=(counts[m]||0)+alpha; sum+=probs[m];}
      for(let m of moves){probs[m]/=sum;}
      return probs;
    }
    function aiChoose(prev){
      if(!prev||Math.random()<epsilon)return {move:randomMove(),mode:'random'};
      const probs=getConditionalProbs(prev);
      if(responseMode==='max'){
        let maxP=-1,best=[];
        for(let m of moves){
          if(probs[m]>maxP+1e-12){maxP=probs[m];best=[m];}
          else if(Math.abs(probs[m]-maxP)<1e-12)best.push(m);
        }
        const predicted=best[Math.floor(Math.random()*best.length)];
        return {move:{'scissors':'rock','rock':'paper','paper':'scissors'}[predicted],mode:'max',predicted,probs};
      }else{
        const counter={'scissors':'rock','rock':'paper','paper':'scissors'};
        const aiWeights={'scissors':0,'rock':0,'paper':0};
        for(let m of moves)aiWeights[counter[m]]+=probs[m];
        let r=Math.random(),cum=0;
        for(let m of moves){cum+=aiWeights[m];if(r<=cum+1e-12)return{move:m,mode:'mixed',probs,aiWeights};}
        return{move:randomMove(),mode:'mixed',probs,aiWeights};
      }
    }

    function playRound(playerMove){
      const aiDec=aiChoose(prevPlayer);
      const compMove=aiDec.move;
      updateTransition(prevPlayer,playerMove);
      prevPlayer=playerMove;

      const outcome=decideOutcome(playerMove,compMove);
      if(outcome==='win')playerScore++;
      else if(outcome==='lose')computerScore++;
      else drawScore++;

      playerScoreEl.textContent=playerScore;
      computerScoreEl.textContent=computerScore;
      drawScoreEl.textContent=drawScore;
      roundInfoEl.textContent=`ä½ å‡º ${labels[playerMove]}ï¼Œé›»è…¦å‡º ${labels[compMove]}ã€‚`;
      whoEl.textContent=outcome==='win'?'ä½ è´äº†':outcome==='lose'?'ä½ è¼¸äº†':'å¹³æ‰‹';
      whoEl.style.color=outcome==='win'?'#0b8457':outcome==='lose'?'#c62828':'#444';

      if(aiDec.mode==='random')aiInfoEl.textContent='AI ä½¿ç”¨éš¨æ©Ÿç­–ç•¥ï¼ˆæ¢ç´¢æˆ–ç„¡ä¸Šä¸€æ‰‹ï¼‰ã€‚';
      else if(aiDec.mode==='max'){
        const p=aiDec.probs;
        aiInfoEl.textContent=`AI é æ¸¬ä½ ä¸‹ä¸€æ‰‹æ©Ÿç‡ï¼šå‰ªåˆ€ ${(p.scissors*100).toFixed(1)}%ã€çŸ³é ­ ${(p.rock*100).toFixed(1)}%ã€å¸ƒ ${(p.paper*100).toFixed(1)}%ã€‚AI ç¡¬æ€§ååˆ¶å‡º ${labels[compMove]}ã€‚`;
      }else{
        const p=aiDec.probs,w=aiDec.aiWeights;
        aiInfoEl.textContent=`AI æ··åˆå›æ‡‰ã€‚æ¢ä»¶æ©Ÿç‡ï¼šå‰ªåˆ€ ${(p.scissors*100).toFixed(1)}%ã€çŸ³é ­ ${(p.rock*100).toFixed(1)}%ã€å¸ƒ ${(p.paper*100).toFixed(1)}%ï¼›å‡ºæ‹³æ¬Šé‡ï¼šå‰ªåˆ€ ${(w.scissors*100).toFixed(1)}%ã€çŸ³é ­ ${(w.rock*100).toFixed(1)}%ã€å¸ƒ ${(w.paper*100).toFixed(1)}%ã€‚`;
      }

      const t=new Date().toLocaleTimeString();
      historyLog.unshift(`${t} â€” ä½ :${labels[playerMove]} é›»è…¦:${labels[compMove]} â†’ ${outcome==='win'?'ä½ è´':outcome==='lose'?'ä½ è¼¸':'å¹³æ‰‹'}`);
      if(historyLog.length>300)historyLog.pop();
      renderLog();
    }

    function renderLog(){
      logEl.innerHTML='<div class="small">éŠæˆ²ç´€éŒ„ï¼ˆæœ€è¿‘è¨˜éŒ„ï¼‰</div>';
      for(let h of historyLog){const d=document.createElement('div');d.textContent=h;logEl.appendChild(d);}
    }

    document.querySelectorAll('.choice-btn').forEach(btn=>{
      btn.addEventListener('click',()=>playRound(btn.dataset.move));
    });

    resetBtn.addEventListener('click',()=>{
      if(!confirm('ç¢ºå®šè¦é‡è¨­ï¼Ÿ'))return;
      initAI();
      playerScoreEl.textContent=computerScoreEl.textContent=drawScoreEl.textContent='0';
      roundInfoEl.textContent='å·²é‡è¨­';
      whoEl.textContent=''; aiInfoEl.textContent='';
      renderLog();
    });
  </script>
</body>
</html>

