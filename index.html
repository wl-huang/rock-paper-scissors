<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>çŒœæ‹³</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK TC", "å¾®è»Ÿæ­£é»‘é«”", Arial; padding: 1.2rem; background:#f6f8fa; color:#222; }
    .container { max-width:920px; margin:0 auto; background:#fff; padding:1.2rem; border-radius:10px; box-shadow:0 6px 18px rgba(30,30,30,0.06); }
    .choices { display:flex; gap:0.6rem; margin:1rem 0; }
    .choice-btn { flex:1; padding:0.75rem; border-radius:8px; border:1px solid #ddd; background:linear-gradient(#fff,#f2f4f7); cursor:pointer; font-size:1.05rem; font-weight:600; }
    .result { margin-top:1rem; padding:0.75rem; border-radius:8px; border:1px dashed #e4e7eb; background:#fcfdff; }
    .small { font-size:0.85rem; color:#666; }
    .settings { margin-top:0.75rem; display:flex; gap:0.6rem; align-items:center; flex-wrap:wrap; }
    .scoreboard { display:flex; gap:0.8rem; margin-top:1rem; }
    .score-box { flex:1; padding:0.6rem; border-radius:8px; background:#f8fafc; border:1px solid #eef2f7; text-align:center; }
    .log { margin-top:1rem; max-height:220px; overflow:auto; padding:0.6rem; background:#fafafa; border-radius:8px; border:1px solid #eee; font-size:0.95rem; white-space:pre-wrap; }
    label { font-size:0.9rem; color:#333; }
    input[type="number"] { width:6rem; padding:0.2rem; }
    .explain { margin-top:0.8rem; padding:0.8rem; border-radius:8px; background:#fffaf0; border:1px solid #f0e6cc; color:#3a3a3a; }
    .muted { color:#666; font-size:0.9rem; }
  </style>
</head>
<body>
  <div class="container">
    <h1>çŒœæ‹³éŠæˆ²ï¼ˆé¦¬å¯å¤«éˆ AIï¼‰</h1>
    <p class="small">AI æ ¹æ“šä½ ä¸Šä¸€æ‰‹çš„è½‰ç§»æ©Ÿç‡ä¼°è¨ˆä¸‹ä¸€æ‰‹ï¼Œä¸¦å¯é¸æ“‡æ··åˆå›æ‡‰æˆ–ç›´æ¥ååˆ¶æœ€å¯èƒ½æ‰‹å‹¢ã€‚</p>

    <div class="settings">
      <label>å¹³æ»‘ Î±ï¼š<input id="alpha" type="number" step="0.1" min="0" value="1" /></label>
      <label>æ¢ç´¢ç‡ Îµï¼š<input id="epsilon" type="number" step="0.01" min="0" max="1" value="0.12" /></label>
      <label>è¨˜æ†¶ä¸Šé™ï¼ˆæœ€å¤§è¨˜éŒ„é•·åº¦ï¼‰ï¼š<input id="maxHist" type="number" min="10" value="200" /></label>
      <label>å›æ‡‰æ¨¡å¼ï¼š
        <select id="responseMode">
          <option value="mixed">æ··åˆå›æ‡‰ï¼ˆæŒ‰æ¢ä»¶æ©Ÿç‡æ··åˆé¸æ“‡ï¼‰</option>
          <option value="max">å°æœ€å¤§è€…ç¡¬æ€§ååˆ¶ï¼ˆargmaxï¼‰</option>
        </select>
      </label>
      <button id="apply">å¥—ç”¨</button>
    </div>

    <div class="explain">
      <strong>åƒæ•¸èªªæ˜ï¼ˆç°¡æ˜ï¼‰</strong>
      <div class="muted">
        å¹³æ»‘ Î±ï¼ˆalphaï¼‰ï¼šè¨ˆç®—æ¢ä»¶æ©Ÿç‡æ™‚æŠŠè¨ˆæ•¸åŠ ä¸Š Î±ï¼Œå…¬å¼ç‚ºï¼šP(next=j | prev=i) = (C_{ij} + Î±) / Î£_k (C_{ik} + Î±)ã€‚
        å»ºè­° Î±=1 ç‚ºå¸¸ç”¨çš„ã€ŒåŠ ä¸€å¹³æ»‘ã€ï¼Œè‹¥è¦ AI æ›´å¿«åæ˜ çœŸå¯¦æ¬¡æ•¸å¯æ¸›å° Î±ï¼ˆä¾‹å¦‚ 0.1ï¼‰ã€‚
      </div>
      <div class="muted" style="margin-top:8px;">
        æ¢ç´¢ç‡ Îµï¼ˆepsilonï¼‰ï¼šAI ä»¥ Îµ æ©Ÿç‡éš¨æ©Ÿå‡ºæ‹³ï¼ˆæ¢ç´¢ï¼‰ï¼Œä»¥ 1-Îµ æ©Ÿç‡ä½¿ç”¨é¦¬å¯å¤«ä¼°è¨ˆåšæ±ºç­–ã€‚å»ºè­° Îµ ç´„ 0.05~0.2ã€‚
      </div>
    </div>

    <div class="choices" role="group" aria-label="å‡ºæ‹³é¸æ“‡">
      <button class="choice-btn" data-move="scissors">âœŒï¸ å‰ªåˆ€</button>
      <button class="choice-btn" data-move="rock">ğŸª¨ çŸ³é ­</button>
      <button class="choice-btn" data-move="paper">ğŸ§» å¸ƒ</button>
    </div>

    <div class="result" id="result">
      <div id="roundInfo">å°šæœªé–‹å§‹</div>
      <div id="who" style="font-weight:700; margin-top:0.4rem;"></div>
      <div id="aiInfo" style="margin-top:0.5rem; font-size:0.95rem; color:#333;"></div>
    </div>

    <div class="scoreboard">
      <div class="score-box"><div class="small">ä½ ï¼ˆç©å®¶ï¼‰</div><div id="playerScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
      <div class="score-box"><div class="small">å¹³æ‰‹</div><div id="drawScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
      <div class="score-box"><div class="small">é›»è…¦</div><div id="computerScore" style="font-size:1.3rem; font-weight:700;">0</div></div>
    </div>

    <button id="resetBtn" style="margin-top:0.8rem;">é‡è¨­æ¯”åˆ†èˆ‡ AI ç´€éŒ„</button>

    <div class="log" id="log"><div class="small">éŠæˆ²ç´€éŒ„ï¼ˆæœ€è¿‘è¨˜éŒ„ï¼‰</div></div>
  </div>

  <script>
    var moves = ['scissors','rock','paper'];
    var labels = { 'scissors': 'å‰ªåˆ€ âœŒï¸', 'rock': 'çŸ³é ­ ğŸª¨', 'paper': 'å¸ƒ ğŸ§»' };

    // DOM
    var alphaInput = document.getElementById('alpha');
    var epsilonInput = document.getElementById('epsilon');
    var maxHistInput = document.getElementById('maxHist');
    var responseModeEl = document.getElementById('responseMode');
    var applyBtn = document.getElementById('apply');
    var resetBtn = document.getElementById('resetBtn');

    var roundInfoEl = document.getElementById('roundInfo');
    var whoEl = document.getElementById('who');
    var aiInfoEl = document.getElementById('aiInfo');
    var logEl = document.getElementById('log');
    var playerScoreEl = document.getElementById('playerScore');
    var computerScoreEl = document.getElementById('computerScore');
    var drawScoreEl = document.getElementById('drawScore');

    // åƒæ•¸
    var alpha = parseFloat(alphaInput.value) || 1.0;
    var epsilon = parseFloat(epsilonInput.value) || 0.12;
    var maxHist = parseInt(maxHistInput.value, 10) || 200;
    var responseMode = responseModeEl.value; // 'mixed' or 'max'

    // è¨˜éŒ„
    var playerScore = 0, computerScore = 0, drawScore = 0;
    var playerHistory = [];
    var transitionCounts = {
      'scissors': {'scissors':0,'rock':0,'paper':0},
      'rock': {'scissors':0,'rock':0,'paper':0},
      'paper': {'scissors':0,'rock':0,'paper':0}
    };
    var prevPlayer = null;
    var historyLog = [];

    function decideOutcome(player, comp) {
      if (player === comp) return 'draw';
      var winPairs = {'scissors':'paper','rock':'scissors','paper':'rock'};
      return winPairs[player] === comp ? 'win' : 'lose';
    }
    function randomMove() { return moves[Math.floor(Math.random()*moves.length)]; }

    function updateTransition(prev, cur) {
      if (prev === null) return;
      if (transitionCounts[prev] && transitionCounts[prev].hasOwnProperty(cur)) {
        transitionCounts[prev][cur] += 1;
      }
    }

    function getConditionalProbs(prev) {
      var counts = transitionCounts[prev];
      var probs = {};
      var total = 0;
      for (var i=0;i<moves.length;i++){
        var m = moves[i];
        probs[m] = (counts[m] || 0) + alpha;
        total += probs[m];
      }
      for (var i=0;i<moves.length;i++){
        var m = moves[i];
        probs[m] = probs[m] / total;
      }
      return probs;
    }

    function aiChoose(prev) {
      if (prev === null || Math.random() < epsilon) {
        return { move: randomMove(), mode: 'random' };
      }
      var probs = getConditionalProbs(prev);
      if (responseMode === 'max') {
        var maxP = -1;
        var cands = [];
        for (var i=0;i<moves.length;i++){
          var m = moves[i];
          var p = probs[m];
          if (p > maxP + 1e-12) { maxP = p; cands = [m]; }
          else if (Math.abs(p - maxP) < 1e-12) { cands.push(m); }
        }
        var predicted = cands[Math.floor(Math.random()*cands.length)];
        var counter = { 'scissors':'rock', 'rock':'paper', 'paper':'scissors' };
        return { move: counter[predicted], mode: 'max', probs: probs, predicted: predicted };
      } else {
        var counter = { 'scissors':'rock', 'rock':'paper', 'paper':'scissors' };
        var aiWeights = { 'scissors':0, 'rock':0, 'paper':0 };
        for (var j=0;j<moves.length;j++){
          var jj = moves[j];
          var aiMove = counter[jj];
          aiWeights[aiMove] += probs[jj];
        }
        var r = Math.random();
        var cum = 0;
        for (var k=0;k<moves.length;k++){
          var mm = moves[k];
          cum += aiWeights[mm];
          if (r <= cum + 1e-12) return { move: mm, mode:'mixed', probs: probs, aiWeights: aiWeights };
        }
        return { move: randomMove(), mode:'mixed', probs: probs, aiWeights: aiWeights };
      }
    }

    function playRound(playerMove) {
      var prev = prevPlayer;
      var aiDec = aiChoose(prev);
      var compMove = aiDec.move;

      updateTransition(prev, playerMove);
      playerHistory.push(playerMove);
      if (playerHistory.length > maxHist) playerHistory.shift();
      prevPlayer = playerMove;

      var outcome = decideOutcome(playerMove, compMove);
      if (outcome === 'win') playerScore++;
      else if (outcome === 'lose') computerScore++;
      else drawScore++;

      playerScoreEl.textContent = playerScore;
      computerScoreEl.textContent = computerScore;
      drawScoreEl.textContent = drawScore;

      roundInfoEl.textContent = 'ä½ å‡º ' + labels[playerMove] + 'ï¼Œé›»è…¦å‡º ' + labels[compMove] + 'ã€‚';
      if (outcome === 'win') { whoEl.textContent = 'ä½ è´äº† ğŸ‰'; whoEl.style.color = '#0b8457'; }
      else if (outcome === 'lose') { whoEl.textContent = 'ä½ è¼¸äº† ğŸ˜'; whoEl.style.color = '#c62828'; }
      else { whoEl.textContent = 'å¹³æ‰‹ ğŸ¤'; whoEl.style.color = '#444'; }

      if (aiDec.mode === 'random') {
        aiInfoEl.textContent = 'AI ä½¿ç”¨éš¨æ©Ÿç­–ç•¥ï¼ˆæ¢ç´¢æˆ–ç„¡ä¸Šä¸€æ‰‹ï¼‰ã€‚';
      } else if (aiDec.mode === 'max') {
        var p = aiDec.probs;
        aiInfoEl.textContent = 'AI é æ¸¬ä½ åœ¨ä¸Šä¸€æ‰‹å¾Œçš„æ¢ä»¶æ©Ÿç‡ï¼šå‰ªåˆ€ ' + (p.scissors*100).toFixed(1) + '%ã€çŸ³é ­ ' + (p.rock*100).toFixed(1) + '%ã€å¸ƒ ' + (p.paper*100).toFixed(1) + '%ï¼›AI å°æœ€å¤§è€…ç¡¬æ€§ååˆ¶ ' + labels[compMove] + 'ã€‚';
      } else if (aiDec.mode === 'mixed') {
        var p2 = aiDec.probs;
        var w = aiDec.aiWeights;
        aiInfoEl.textContent = 'AI æ ¹æ“šä¸Šä¸€æ‰‹æ··åˆå›æ‡‰ã€‚ç©å®¶æ¢ä»¶æ©Ÿç‡ï¼šå‰ªåˆ€ ' + (p2.scissors*100).toFixed(1) + '%ã€çŸ³é ­ ' + (p2.rock*100).toFixed(1) + '%ã€å¸ƒ ' + (p2.paper*100).toFixed(1) + '%ã€‚AI å‡ºæ‹³æ¬Šé‡ï¼šå‰ªåˆ€ ' + (w.scissors*100).toFixed(1) + '%ã€çŸ³é ­ ' + (w.rock*100).toFixed(1) + '%ã€å¸ƒ ' + (w.paper*100).toFixed(1) + '%ã€‚';
      }

      var t = new Date().toLocaleTimeString();
      historyLog.unshift(t + ' â€” ä½ ï¼š' + labels[playerMove] + 'ï¼Œé›»è…¦ï¼š' + labels[compMove] + ' â†’ ' + (outcome === 'win' ? 'ä½ è´' : outcome === 'lose' ? 'ä½ è¼¸' : 'å¹³æ‰‹'));
      if (historyLog.length > 300) historyLog.pop();
      renderLog();
    }

    function renderLog() {
      logEl.innerHTML = '<div class="small">éŠæˆ²ç´€éŒ„ï¼ˆæœ€è¿‘è¨˜éŒ„ï¼‰</div>';
      for (var i=0;i<historyLog.length;i++){
        var d = document.createElement('div');
        d.textContent = historyLog[i];
        logEl.appendChild(d);
      }
    }

    document.querySelectorAll('.choice-btn').forEach(function(btn){
      btn.addEventListener('click', function(){
        var mv = btn.getAttribute('data-move');
        playRound(mv);
      });
    });

    applyBtn.addEventListener('click', function(){
      var na = parseFloat(alphaInput.value);
      var ne = parseFloat(epsilonInput.value);
      var nm = parseInt(maxHistInput.value, 10);
      var mode = responseModeEl.value;
      if (isNaN(na) || na < 0) { alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Î±ï¼ˆ>=0ï¼‰'); return; }
      if (isNaN(ne) || ne < 0 || ne > 1) { alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ Îµï¼ˆ0~1ï¼‰'); return; }
      if (!Number.isInteger(nm) || nm < 10) { alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æœ€å¤§è¨˜éŒ„é•·åº¦ï¼ˆ>=10ï¼‰'); return; }
      alpha = na; epsilon = ne; maxHist = nm; responseMode = mode;
      alert('å·²å¥—ç”¨ï¼šÎ±=' + alpha + ', Îµ=' + epsilon + ', maxHist=' + maxHist + ', mode=' + responseMode);
    });

    resetBtn.addEventListener('click', function(){
      if (!confirm('ç¢ºå®šè¦é‡è¨­æ¯”åˆ†èˆ‡ AI ç´€éŒ„å—ï¼Ÿ')) return;
      playerScore = 0; computerScore = 0; drawScore = 0;
      playerHistory.length = 0; prevPlayer = null;
      for (var a in transitionCounts) for (var b in transitionCounts[a]) transitionCounts[a][b] = 0;
      historyLog.length = 0;
      playerScoreEl.textContent = '0'; computerScoreEl.textContent = '0'; drawScoreEl.textContent = '0';
      roundInfoEl.textContent = 'å·²é‡è¨­';
      whoEl.textContent = ''; aiInfoEl.textContent = '';
      renderLog();
    });

    renderLog();
  </script>
</body>
</html>
